# Chapter 4. CPU의 작동 원리

### 목표
- ALU와 제어장치에 대해 학습한다.
- 레지스터의 종류와 역할에 대해 학습한다.
- 명령어 사이클을 이해한다.
- 인터럽트의 개념을 이해한다.

### 04-1 ALU와 제어장치

#### 1. ALU (Arithmetic Logic Unit)
- CPU 내부에서 계산을 담당
- 피연산자와 제어신호로 다양한 연산을 수행
- **플래그**: 연산 결과에 대한 추가적인 상태 정보 (예: 결괏값이 음수, 오버플로우 발생)

| 플래그 종류        | 의미                                      | 사용 예시 |
|------------------|------------------------------------------|----------|
| 부호 플래그         | 연산한 결과의 부호를 나타냄                   | 부호 플래그가 1이면 음수, 0이면 양수 |
| 제로 플래그         | 연산 결과가 0인지 여부를 나타냄                 | 제로 플래그가 1이면 결과가 0 |
| 캐리 플래그         | 연산 결과 올림수나 빌림수 발생 여부              | 캐리 플래그가 1이면 올림수/빌림수 발생 |
| 오버플로우 플래그     | 오버플로우 발생 여부를 나타냄                   | 오버플로우 플래그가 1이면 오버플로우 발생 |
| 인터럽트 플래그      | 인터럽트 가능 여부를 나타냄                   | 1이면 인터럽트 가능 |
| 슈퍼바이저 플래그     | 커널 모드 실행 중인지 여부를 나타냄             | 1이면 커널 모드, 0이면 사용자 모드 |

- **플래그 레지스터**: 플래그를 저장하는 레지스터

#### 2. 제어장치 (Control Unit)
- **제어장치**: 제어 신호를 내보내고, 명령어를 해석하는 부품
- **제어 신호**: 컴퓨터 부품들을 관리하고 작동시키기 위한 전기 신호

- 제어장치가 받아들이는 정보의 종류:
  - **클럭 신호**: 컴퓨터의 모든 부품을 움직이게 하는 시간 단위
  - **해석해야 할 명령어**: 명령어 레지스터에 저장됨
  - **플래그 값**
  - **제어 신호**: 제어 버스를 통해 전달됨

### 04-2 레지스터

#### 1. 프로그램 카운터 (Program Counter)
- 메모리에서 읽어 들일 명령어의 주소를 저장

#### 2. 명령어 레지스터 (Instruction Register)
- 메모리에서 읽어 들인 명령어를 저장

#### 3. 메모리 주소 레지스터 (Memory Address Register)
- 메모리의 주소를 저장

#### 4. 메모리 버퍼 레지스터 (Memory Buffer Register)
- 메모리와 주고받을 데이터 또는 명령어를 저장하는 레지스터

#### 5. 범용 레지스터 (General Purpose Register)
- 다양하고 일반적인 상황에서 자유롭게 사용할 수 있는 레지스터

#### 6. 플래그 레지스터 (Flag Register)
- 연산 결과 또는 CPU 상태에 대한 부가적인 정보를 저장

#### 7. 스택 포인터 (Stack Pointer)
- 스택에 마지막으로 저장한 값의 위치를 저장하는 레지스터
- 스택 주소 지정 방식 사용

#### 8. 변위 주소 지정 방식 (Displacement Addressing)
- 오퍼랜드와 특정 레지스터의 값을 더해 유효 주소를 얻는 방식
  - **상대 주소 지정 방식**: 오퍼랜드와 프로그램 카운터의 값을 더해 유효 주소를 얻음
  - **베이스 레지스터 주소 지정 방식**: 오퍼랜드와 베이스 레지스터 값을 더해 유효 주소를 얻음

### 04-3 명령어 사이클과 인터럽트

#### 1. 명령어 사이클 (Instruction Cycle)
- 하나의 명령어를 처리하는 정형화된 흐름
- 명령어 실행 주기:
  - **인출 사이클**: 메모리에서 명령어를 CPU로 가져오는 단계
  - **실행 사이클**: CPU에서 명령어를 실행하는 단계
  - **간접 사이클**: 명령어 실행을 위해 메모리에 추가 접근하는 단계

#### 2. 인터럽트 (Interrupt)
- 명령어 흐름이 끊어지는 상황, CPU의 작업을 방해하는 신호
- **동기 인터럽트 (예외)**: CPU에 의해 발생 (프로그래밍 오류 등)
- **비동기 인터럽트 (하드웨어 인터럽트)**: 입출력 장치에 의해 발생 (프린트 완료 등)

#### 3. 하드웨어 인터럽트 (Hardware Interrupt)
- **인터럽트 요청 신호**
- **인터럽트 플래그**: 활성화되어야 요청 수용 가능
- **인터럽트 벡터**: 인터럽트 서비스 루틴 구분 정보
- **인터럽트 서비스 루틴 (ISR)**: 인터럽트를 처리하는 프로그램

#### 4. 예외 (Exception)
- **폴트 (Fault)**: 예외 처리 후 같은 명령어부터 실행 재개
- **트랩 (Trap)**: 예외 처리 후 다음 명령어부터 실행 재개
- **중단 (Abort)**: CPU가 프로그램을 강제로 중단시킴
- **소프트웨어 인터럽트**: 시스템 호출 발생 시
